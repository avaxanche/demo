steps:
  #Install, compile & copy shared-types

  - name: "gcr.io/cloud-builders/npm"
    args: ["install"]
    env: ["NODE_ENV=development"]
    id: "installjs"

  - name: gcr.io/cloud-builders/gcloud
    args:
      - "-c"
      - |
        version=$BRANCH_NAME
        gcloud beta app deploy app.yaml --version=${version,,//./-} --no-promote
    entrypoint: bash
    id: "deploy"
    wait_for: ["installjs"]

timeout: 1800s
